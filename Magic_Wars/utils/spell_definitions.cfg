#define MW_SPELL_FIREBALL SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
# Worth noting here - "name" isn't something that goes in option normally, but I have it here to make identifying spells easier.
			name= _ "Fireball"
			message={MENU_IMG_TXT "attacks/fireball.png" _"Fireball ($$side_number|.cost.fireball mana)
		Inflict 12 fire damage to non-leader unit at target hex ($x1|,$y1|)"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.fireball}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Fireball on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Fireball"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.fireball}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT Fireball x,y=$target.x,$target.y}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/fireball.png"
				side_for={SIDE}
				message= _ "You have generated Fireball."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_COMBUSTIBOLT SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Combustibolt"
			message={MENU_IMG_TXT "attacks/explosion.png" _"Combustibolt ($$side_number|.cost.combustibolt mana, 4 discarded spells)
		Inflict 14 fire damage to all enemy non-leader units within 1 hex of $x1|,$y1|
		After casting, this spell is destroyed instead of being discarded"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.combustibolt}
					{MW_VARIABLE $side_number|.discarded_spells.option.length greater_than 4}
					[have_unit]
						{MW_ENEMY_OF $side_number}
						[filter_location]
							x,y=$x1,$y1
							radius=1
						[/filter_location]
						{MW_NOT_SPELLPROOF}
					[/have_unit]
					[then]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Activate Combustibolt at $x1|,$y1|?"
							[option]
								message= _ "Yes"
								[command]
									{MW_CLEAR_SPELL $side_number "Combustibolt"}
									{MW_CHANGE_MANA $side_number -$$side_number|.cost.combustibolt}
									{VARIABLE target.x $x1}
									{VARIABLE target.y $y1}
									{MW_FIRE_EVENT Combustibolt}
								[/command]
							[/option]
							[option]
								message= _ "No"
							[/option]
						[/message]
						{CLEAR_VARIABLE victim}
					[/then]
					[else]
						[if]
							{MW_VARIABLE $side_number|.discarded_spells.length less_than_equal_to 4}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough discarded spells to fuel this spell."
								[/message]
							[/then]
							[else]
								[if]
									{MW_VARIABLE $side_number|.mana less_than $$side_number|.cost.combustibolt}
									[then]
										[message]
											speaker=narrator
											side_for=$side_number
											message= _ "Not enough mana to cast this spell."
										[/message]
									[/then]
									[else]
										[message]
											speaker=narrator
											side_for=$side_number
											message= _ "There is no valid target here."
										[/message]
									[/else]
								[/if]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/explosion.png"
				side_for={SIDE}
				message= _ "You have generated Combustibolt."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_POWER_FLOW SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Power Flow"
			message={MENU_IMG_TXT "attacks/thorns.png" _"Power Flow (3 discarded spells)
		Gain 20 mana
		After casting, this spell is destroyed instead of being discarded"}
			[command]
				[if]
# Don't forget, one of the options is there for leaving the menu, so we have to make sure we check to make sure there's one more spell than the amount we need (in this case, 3).
					{MW_VARIABLE $side_number|.discarded_spells.option.length greater_than 3}
					[then]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Activate Power Flow?"
							[option]
								message= _ "Yes"
								[command]
									{MW_CLEAR_SPELL $side_number "Power Flow"}
									{MW_FIRE_EVENT "Power Flow"}
								[/command]
							[/option]
							[option]
								message= _ "No"
							[/option]
						[/message]
					[/then]
					[else]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Not enough discarded spells to cast this spell."
						[/message]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/thorns.png"
				side_for={SIDE}
				message= _ "You have generated Power Flow."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_THUNDERBOLT SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Thunderbolt"
			message={MENU_IMG_TXT "attacks/lightning.png" _"Thunderbolt ($$side_number|.cost.thunderbolt mana)
		Inflict 15 fire damage to non-leader unit at target hex ($x1|,$y1|)
		If target unit flies or is on water, it takes double damage
		If target unit is on water, adjacent enemies on water are also hit"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.thunderbolt}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Thunderbolt on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Thunderbolt"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.thunderbolt}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT Thunderbolt x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/lightning.png"
				side_for={SIDE}
				message= _ "You have generated Thunderbolt."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_NULL_AND_VOID SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Null and Void"
			message={MENU_IMG_TXT "attacks/circle-destr.png" _"Null and Void ($$side_number|.cost.null_and_void mana, hidden spell)
		Cancel the next spell cast by the target mage, and destroy it instead of discarding it"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.null_and_void}
					[then]
						[if]
							{MW_CURSOR_ON_ENEMY_MAGE}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Cast Null and Void on the mage of side $victim.side|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Null and Void"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.null_and_void}
											{MW_FIRE_EVENT "Null and Void"}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Not enough mana to cast this spell."
						[/message]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/circle-destr.png"
				side_for={SIDE}
				message= _ "You have generated Null and Void."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_DISPEL_MALICE SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Dispel Malice"
			message={MENU_IMG_TXT "attacks/aura-fire.png" _"Dispel Malice ($$side_number|.cost.dispel_malice mana, hidden spell)
		Cancel the next damaging spell cast by the target mage"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.dispel_malice}
					[then]
						[if]
							{MW_CURSOR_ON_ENEMY_MAGE}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Cast Dispel Malice on the mage of side $victim.side|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Dispel Malice"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.dispel_malice}
											{MW_FIRE_EVENT "Dispel Malice"}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Not enough mana to cast this spell."
						[/message]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/aura-fire.png"
				side_for={SIDE}
				message= _ "You have generated Dispel Malice."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_SHADOW_STRIKE SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Shadow Strike"
			message={MENU_IMG_TXT "attacks/claws-undead.png" _"Shadow Strike ($$side_number|.cost.shadow_strike mana)
		Inflict 8 chaotic blade damage and deep wound to non-leader unit at target hex ($x1|,$y1|)
		If the target unit is adjacent to at least one of its enemies, it takes double damage
		Undead units cannot get deep wound"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.frost_blast}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Shadow Strike on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Shadow Strike"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.shadow_strike}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT "Shadow Strike" x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/claws-undead.png"
				side_for={SIDE}
				message= _ "You have generated Shadow Strike."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_SNAKEBITE SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Snakebite"
			message={MENU_IMG_TXT "attacks/fangs-snake.png" _"Snakebite ($$side_number|.cost.snakebite mana)
		Inflict 8 pierce damage and poison to non-leader unit at target hex ($x1|,$y1|)"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.snakebite}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Snakebite on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Snakebite"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.snakebite}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT Snakebite x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/fangs-snake.png"
				side_for={SIDE}
				message= _ "You have generated Snakebite."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_RUTHLESS_DENIAL SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Ruthless Denial"
			message={MENU_IMG_TXT "attacks/touch-demon.png" _"Ruthless Denial ($$side_number|.cost.ruthless_denial mana)
		Look at all the spells of the target mage, then discard one of those spells"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.ruthless_denial}
					[then]
						[if]
							{MW_CURSOR_ON_ENEMY_MAGE}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Cast Ruthless Denial on the mage of side $victim.side|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Ruthless Denial"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.ruthless_denial}
											{MW_FIRE_EVENT "Ruthless Denial"}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Not enough mana to cast this spell."
						[/message]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/touch-demon.png"
				side_for={SIDE}
				message= _ "You have generated Ruthless Denial."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_DEBUNK SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Debunk"
			message={MENU_IMG_TXT "attacks/lightfocus.png" _"Debunk ($$side_number|.cost.debunk mana)
		Look at all the hidden spells of the target mage, then disarm one of those spells
		This spell cannot be canceled"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.debunk}
					[then]
						[if]
							{MW_CURSOR_ON_ENEMY_MAGE}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Cast Debunk on the mage of side $victim.side|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Debunk"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.debunk}
											{MW_FIRE_EVENT "Debunk"}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Not enough mana to cast this spell."
						[/message]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/lightfocus.png"
				side_for={SIDE}
				message= _ "You have generated Debunk."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_FROST_BLAST SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Frost Blast"
			message={MENU_IMG_TXT "attacks/iceball.png" _"Frost blast ($$side_number|.cost.frost_blast mana)
		Inflict 10 cold damage and slow to non-leader unit at target hex ($x1|,$y1|)"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.frost_blast}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Frost blast on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Frost Blast"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.frost_blast}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT "Frost Blast" x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/iceball.png"
				side_for={SIDE}
				message= _ "You have generated Frost Blast."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_STASIS SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Stasis"
			message={MENU_IMG_TXT "attacks/vortex.png" _"Stasis ($$side_number|.cost.stasis mana)
		Petrify non-mage unit at target hex ($x1|,$y1|) and grant it spellproof for two turns"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.stasis}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					{MW_CURSOR_NOT_ON_MAGE}
					[then]
						[if]
							[have_unit]
								[not]
									{MW_IS_MAGE}
								[/not]
							[/have_unit]
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Stasis on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Stasis"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.stasis}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT Stasis x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/vortex.png"
				side_for={SIDE}
				message= _ "You have generated Stasis."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_REAP SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Reap"
			message={MENU_IMG_TXT "units/undead/spectre.png" _"Reap ($$side_number|.cost.reap mana)
		Inflict 40% of the missing health of the target unit at ($x1|,$y1|) as typeless damage to that unit
		If this spell kills the target unit, its mana cost is refunded"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.reap}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Reap on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Reap"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.reap}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT "Reap" x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="units/undead/spectre.png"
				side_for={SIDE}
				message= _ "You have generated Reap."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_RECALL_COMMAND SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Recall Command"
			message={MENU_IMG_TXT "units/human-loyalists/general-leading.png" _"Recall Command ($$side_number|.cost.recall_command mana)
		Teleports target non-leader unit not on a village at ($x1|,$y1|) to its leader"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.recall_command}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER}
							[not]
								[have_location]
									x,y=$x1,$y1
									terrain=*^V*
								[/have_location]
							[/not]
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Recall Command on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Recall Command"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.recall_command}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT "Recall Command" x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="units/human-loyalists/general-leading.png"
				side_for={SIDE}
				message= _ "You have generated Recall Command."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_EARTHQUAKE SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Earthquake"
			message={MENU_IMG_TXT "attacks/crush-wose.png" _"Earthquake ($$side_number|.cost.earthquake mana)
		Inflict 18 impact damage to ALL non-flying, non-leader units on or adjacent to target hex ($x1|,$y1|)
		Mountains and villages on the affected area are turned into hills and ruins, respectively
		Any unit on terrain that is changed takes an additional 18 impact damage"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.earthquake}
					[then]
						{MW_STORE_UNIT victim x,y=$x1,$y1}
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Activate Earthquake at $x1|,$y1|?"
							[option]
								message= _ "Yes"
								[command]
									{MW_DISCARD_SPELL $side_number "Earthquake"}
									{MW_CHANGE_MANA $side_number -$$side_number|.cost.earthquake}
									{VARIABLE target.x $x1}
									{VARIABLE target.y $y1}
									{MW_FIRE_EVENT Earthquake}
								[/command]
							[/option]
							[option]
								message= _ "No"
							[/option]
						[/message]
						{CLEAR_VARIABLE victim}
					[/then]
					[else]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Not enough mana to cast this spell."
						[/message]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/crush-wose.png"
				side_for={SIDE}
				message= _ "You have generated Earthquake."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_SMITE SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Smite"
			message={MENU_IMG_TXT "attacks/lightbeam.png" _"Smite ($$side_number|.cost.smite mana)
		Inflict 10 arcane damage to non-leader unit at target hex ($x1|,$y1|)
		If the target unit has negative resistance to arcane, it cannot move on its next turn"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.smite}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Smite on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Smite"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.smite}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT "Smite" x,y=$x1,$y1}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/lightbeam.png"
				side_for={SIDE}
				message= _ "You have generated Smite."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_TREMORS SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Tremors"
			message={MENU_IMG_TXT "scenery/slab1.png" _"Tremors ($$side_number|.cost.tremors mana)
		Inflict 4-6 impact damage to all non-flying units in the targeted area each turn for a day
		You can only have one Tremors active"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.tremors}
					{MW_VARIABLE $side_number|.tremors.duration equals $empty}
					[then]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "Activate Tremors at $x1|,$y1|?"
							[option]
								message= _ "Yes"
								[command]
									{MW_DISCARD_SPELL $side_number "Tremors"}
									{MW_CHANGE_MANA $side_number -$$side_number|.cost.tremors}
									{VARIABLE target.x $x1}
									{VARIABLE target.y $y1}
									{MW_FIRE_EVENT Tremors}
								[/command]
							[/option]
							[option]
								message= _ "No"
							[/option]
						[/message]
						{CLEAR_VARIABLE victim}
					[/then]
					[else]
						[if]
							{MW_VARIABLE $side_number|.tremors.duration not_equals $empty}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You still have Tremors active for $$side_number|.tremors.duration turns."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="scenery/slab1.png"
				side_for={SIDE}
				message= _ "You have generated Tremors."
			[/message]
		[/then]
	[/if]
#enddef

#define MW_SPELL_ICE_SHARDS SIDE
	[set_variables]
		name={SIDE}.spells.option
		mode=append
		[literal]
			name= _ "Ice Shards"
			message={MENU_IMG_TXT "attacks/ice-shard.png" _"Ice Shards ($$side_number|.cost.ice_shards mana)
		Inflict 6 cold damage and 6 pierce damage to non-leader unit at target hex ($x1|,$y1|)"}
			[command]
				[if]
					{MW_HAVE_MANA $$side_number|.cost.ice_shards}
					{MW_CURSOR_NOT_ON_SPELLPROOF}
					[then]
						[if]
							{MW_CURSOR_ON_NONLEADER_ENEMY}
							[then]
								{MW_STORE_UNIT victim x,y=$x1,$y1}
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Activate Ice Shard on the $victim.type| at $x1|,$y1|?"
									[option]
										message= _ "Yes"
										[command]
											{MW_DISCARD_SPELL $side_number "Ice Shards"}
											{MW_CHANGE_MANA $side_number -$$side_number|.cost.ice_shards}
											{VARIABLE target.x $x1}
											{VARIABLE target.y $y1}
											{MW_FIRE_EVENT_UNIT "Ice Shards" x,y=$target.x,$target.y}
										[/command]
									[/option]
									[option]
										message= _ "No"
									[/option]
								[/message]
								{CLEAR_VARIABLE victim}
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "There is no valid target here."
								[/message]
							[/else]
						[/if]
					[/then]
					[else]
						[if]
							{MW_CURSOR_ON_SPELLPROOF}
							[then]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "You cannot cast this spell on this unit - it is spellproof."
								[/message]
							[/then]
							[else]
								[message]
									speaker=narrator
									side_for=$side_number
									message= _ "Not enough mana to cast this spell."
								[/message]
							[/else]
						[/if]
					[/else]
				[/if]
			[/command]
		[/literal]
	[/set_variables]
	[if]
		{MW_VARIABLE announce_spell_generation equals yes}
		[then]
			[message]
				speaker=narrator
				image="attacks/ice-shard.png"
				side_for={SIDE}
				message= _ "You have generated Ice Shards."
			[/message]
		[/then]
	[/if]
#enddef



#define MW_ADD_SPELL NAME
	[set_variables]
		name=random_spell
		mode=append
		[value]
			name={NAME}
		[/value]
	[/set_variables]
#enddef

#define MW_GIVE_SPELL NAME SIDE
	{VARIABLE spell {NAME}}
	[switch]
		variable=spell
		[case]
			value="Fireball"
			{MW_SPELL_FIREBALL {SIDE}}
		[/case]
		[case]
			value="Snakebite"
			{MW_SPELL_SNAKEBITE {SIDE}}
		[/case]
		[case]
			value="Frost Blast"
			{MW_SPELL_FROST_BLAST {SIDE}}
		[/case]
		[case]
			value="Ruthless Denial"
			{MW_SPELL_RUTHLESS_DENIAL {SIDE}}
		[/case]
		[case]
			value="Thunderbolt"
			{MW_SPELL_THUNDERBOLT {SIDE}}
		[/case]
		[case]
			value="Shadow Strike"
			{MW_SPELL_SHADOW_STRIKE {SIDE}}
		[/case]
		[case]
			value="Power Flow"
			{MW_SPELL_POWER_FLOW {SIDE}}
		[/case]
		[case]
			value="Null and Void"
			{MW_SPELL_NULL_AND_VOID {SIDE}}
		[/case]
		[case]
			value="Dispel Malice"
			{MW_SPELL_DISPEL_MALICE {SIDE}}
		[/case]
		[case]
			value="Debunk"
			{MW_SPELL_DEBUNK {SIDE}}
		[/case]
		[case]
			value="Stasis"
			{MW_SPELL_STASIS {SIDE}}
		[/case]
		[case]
			value="Reap"
			{MW_SPELL_REAP {SIDE}}
		[/case]
		[case]
			value="Recall Command"
			{MW_SPELL_RECALL_COMMAND {SIDE}}
		[/case]
		[case]
			value="Earthquake"
			{MW_SPELL_EARTHQUAKE {SIDE}}
		[/case]
		[case]
			value="Smite"
			{MW_SPELL_SMITE {SIDE}}
		[/case]
		[case]
			value="Tremors"
			{MW_SPELL_TREMORS {SIDE}}
		[/case]
		[case]
			value="Combustibolt"
			{MW_SPELL_COMBUSTIBOLT {SIDE}}
		[/case]
		[case]
			value="Ice Shards"
			{MW_SPELL_ICE_SHARDS {SIDE}}
		[/case]
	[/switch]
#enddef